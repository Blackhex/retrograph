buildscript {
  apply from: "dependencies.gradle"

  repositories {
    jcenter()
    google()
    maven {
      url "https://plugins.gradle.org/m2/"
    }
  }
  dependencies {
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion"
    classpath 'com.netflix.nebula:gradle-lint-plugin:latest.release'
    //classpath 'org.junit.platform:junit-platform-gradle-plugin:1.0.0'
    classpath "org.jacoco:org.jacoco.core:$jacocoVersion"
  }
}

//apply plugin: 'org.junit.platform.gradle.plugin'

/*junitPlatform {
  filters {
    engines {
      include 'spek'
    }
  }
}*/

repositories {
  jcenter()
  google()
  maven {
    url "http://dl.bintray.com/jetbrains/spek"
  }
  maven {
    url 'http://trinerdis.cz:8000/repository/snapshots/'
    credentials {
      username 'development'
      password System.getenv("DEPLOYMENT_PASSWORD")
    }
  }
}

apply from: "dependencies.gradle"

apply plugin: 'kotlin'
apply plugin: 'kotlin-kapt'
apply plugin: 'jacoco'
apply plugin: 'maven'

dependencies {
  implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlinVersion"
  implementation "com.squareup.retrofit2:retrofit:$retrofitVersion"
  implementation "com.squareup.retrofit2:converter-gson:$retrofitVersion"
  implementation "com.squareup.retrofit2:adapter-rxjava2:$retrofitVersion"
  implementation "com.squareup.okhttp3:logging-interceptor:$okhttpVersion"
  implementation "com.google.code.gson:gson:$gsonVersion"
  implementation "io.reactivex.rxjava2:rxjava:$rxJavaVersion"

  //testImplementation "org.junit.jupiter:junit-jupiter-api:$junit5Version"
  //testRuntimeOnly "org.junit.jupiter:junitn-jupiter-engine:$junit5Version"
  //testImplementation "org.jetbrains.spek:spek-api:$spekVersion"
  //testRuntime "org.jetbrains.spek:spek-junit-platform-engine:$spekVersion"
  testImplementation "com.squareup.okhttp3:mockwebserver:$okhttpVersion"

  // TODO: Remove this.
  implementation "com.android.support:support-annotations:$supportVersion"
  testImplementation "junit:junit:4.12"
  testImplementation "io.mockk:mockk:$mockkVersion"
  testImplementation "org.assertj:assertj-core:3.10.0"
  testImplementation "com.google.guava:guava:22.0"
  //#implementation(group: 'com.google.code.findbugs', name: 'jsr305', version: '3.0.2'
}

// Test tasks are never up-to-date.
tasks.withType(Test) {
  outputs.upToDateWhen { false }
}

// region Code Coverage

jacoco {
  toolVersion = "$jacocoVersion"
}

tasks.withType(Test) {
  jacoco.includeNoLocationClasses = true
}

// endregion Code Coverage

// region Deployment

uploadArchives {
  repositories {
    mavenDeployer {
      repository(url: "http://trinerdis.cz:8000/repository/snapshots/") {
        authentication(userName: "deployment", password: "pwn3dbypicky")
      }
      pom.version = "0.1-SNAPSHOT"
      pom.artifactId = "retrograph"
      pom.groupId = "com.kiwi.mobile"
    }
  }
}

// endregion Deployment

